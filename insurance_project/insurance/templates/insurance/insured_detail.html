{% extends 'insurance/base.html' %}
{% load static %}

{% block title %}Detail pojištěnce{% endblock %}

{% block content %}
<div class="container">
    {% if messages %}
        <div class="alert alert-success">
            {% for message in messages %}
                {{ message }}
            {% endfor %}
        </div>
    {% endif %}

    <div class="profile-header">
        <div class="profile-image">
            <img src="{% static 'images/profile_picture.png' %}" alt="{{ insured_person.first_name }} {{ insured_person.last_name }}">
        </div>
        <div class="profile-info">
            <div class="left-info">
                <h1>{{ insured_person.first_name }} {{ insured_person.last_name }}</h1>
                <p>{{ insured_person.street_address }}<br>{{ insured_person.city }}<br>{{ insured_person.postal_code }}</p>
            </div>
            <div class="right-info">
                <p>{{ insured_person.id_number }}</p>
                <p>{{ insured_person.email }}</p>
                <p>{{ insured_person.phone_number }}</p>
            </div>
        </div>
    </div>

    <h2>Sjednaná pojištění</h2>
    <table class="table table-striped insured-detail-table">
        <thead>
            <tr>
                <th>Pojištění</th>
                <th>Částka</th>
                <th>Akce</th>
            </tr>
        </thead>
        <tbody>
            {% for policy in policies %}
            <tr>
                <td><a href="{% url 'insurance_coverage_list' policy.insurance_coverage.insurance_type.id %}?coverage_id={{ policy.insurance_coverage.id }}">{{ policy.insurance_coverage.name }}</a></td>
                <td>{{ policy.premium|floatformat:0 }} Kč</td>
                <td>
                    {% if user.is_staff %}
                        <a href="{% url 'edit_policy' policy.id %}" class="btn btn-warning btn-sm">Editovat</a>
                        <a href="{% url 'delete_policy' policy.id %}" class="btn btn-danger btn-sm">Odstranit</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}

            <tr>
                <td class="text-right"><strong>Roční pojistné celkem:</strong></td>
                <td><strong>{{ total_premium|floatformat:0 }} Kč</strong></td>
                <td></td>
            </tr>
        </tbody>
    </table>

    <div class="btn-group-centered">
        <a href="{% url 'add_policy_from_insured' insured_person.id %}" class="btn btn-primary btn-create-policy">Zřídit pojištění</a>
        <a href="{% url 'edit_insured' insured_person.id %}" class="btn btn-warning">Editovat pojištěnce</a>
        {% if user.is_staff %}
            <a href="{% url 'delete_insured' insured_person.id %}" class="btn btn-danger">Odstranit pojištěnce</a>
        {% endif %}
    </div>
</div>
{% endblock %}